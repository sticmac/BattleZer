<!doctype html>
<html>
<head>
    <title>BattleZer Client</title>
    <style>
        .btns {
            background-color: bisque;
            margin-top: 50px;
        }

        #messages {
            background-color: lavenderblush;
            margin-top: 50px;
        }

        #messages li:nth-child(odd) {
            background-color: lavender
        }

        .btns li {
            margin: 10px 0px;
        }

        .hit td {
            border: 1px solid #970aa3;
            padding: 10px 5px;
        }

        .style td {
            border: 1px solid #238f23;
            padding: 10px 5px;
        }

        .hit2 td {
            border: 1px solid #970aa3;
            padding: 10px 5px;
        }

        .style2 td {
            border: 1px solid #238f23;
            padding: 10px 5px;
        }
    </style>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<div class="container">


    <div class="row text-center">

        <div class="col-sm-6 btns">
            <div style="padding: 15px 0">
                <button type="button" class="btn btn-danger" onclick="resetGames()">reset games
                </button>
            </div>
            <div class="row">
                <div class="col-sm-6 standalone">
                    <h4>Standalone scénario</h4>
                    <ol>
                        <li>
                            <button type="button" class="btn btn-secondary" onclick="connectTable('standalone')">connect
                                as
                                standalone
                            </button>
                        </li>
                        <li>
                            <button type="button" class="btn btn-secondary" onclick="distribute('gameroom#1')">
                                distribute cards
                            </button>
                        </li>
                        <li>
                            <button type="button" class="btn btn-secondary" onclick="sendAllPicks()">send picks
                            </button>
                        </li>
                        <li>
                            <div>player 1 moves to position :</div>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" onclick="sendEffect1(2)" class="btn btn-secondary">#2</button>
                                <button type="button" onclick="sendEffect1(4)" class="btn btn-secondary">#4</button>
                                <button type="button" onclick="sendEffect1(7)" class="btn btn-secondary">#7</button>
                            </div>
                        </li>
                        <li>
                            <div>player 2 moves to position :</div>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" onclick="sendEffect2(3)" class="btn btn-secondary">#3</button>
                                <button type="button" onclick="sendEffect2(5)" class="btn btn-secondary">#5</button>
                                <button type="button" onclick="sendEffect2(8)" class="btn btn-secondary">#8</button>
                            </div>
                        </li>
                        <li>
                            <div>player 1 attacks (-10 hp) on position :</div>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" onclick="sendAction1(3)" class="btn btn-secondary">#3</button>
                                <button type="button" onclick="sendAction1(5)" class="btn btn-secondary">#5</button>
                                <button type="button" onclick="sendAction1(8)" class="btn btn-secondary">#8</button>
                            </div>
                        </li>
                        <li>
                            <div>player 2 attacks (-5 hp) on position :</div>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" onclick="sendAction2(2)" class="btn btn-secondary">#2</button>
                                <button type="button" onclick="sendAction2(4)" class="btn btn-secondary">#4</button>
                                <button type="button" onclick="sendAction2(7)" class="btn btn-secondary">#7</button>
                            </div>
                        </li>
                    </ol>
                </div>

                <div class="col-sm-6 distributed-scenario">
                    <h4>Distributed scénario</h4>
                    <ol>
                        <li>
                            <button type="button" class="btn btn-primary" onclick="connectTable('distributed')">connect
                                as
                                distributed
                            </button>
                        </li>
                        <li>
                            <button type="button" class="btn btn-primary" onclick="connectPhone1('gameroom#1')">connect
                                Phone 1
                            </button>
                        </li>
                        <li>
                            <button type="button" class="btn btn-primary" onclick="connectPhone2('gameroom#1')">connect
                                Phone 2
                            </button>
                        </li>

                        <li>
                            <button type="button" class="btn btn-primary" onclick="distribute('gameroom#1')">distribute
                                cards
                            </button>
                        </li>
                        <li>
                            <button type="button" class="btn btn-primary" onclick="sendPhone1Picks()">send picks Phone 1
                            </button>
                        </li>
                        <li>
                            <button type="button" class="btn btn-primary" onclick="sendPhone2Picks()">send picks Phone 2
                            </button>
                        </li>
                    </ol>

                </div>

            </div>


            <hr>
            <h4>Smartphone 1</h4>

            <table>
                <tr class="hit">
                    <td id="hcard1">hit carte 1</td>
                    <td id="hcard2">hit carte 2</td>
                    <td id="hcard3">hit carte 3</td>
                    <td id="hcard4">hit carte 4</td>
                    <td id="hcard5">hit carte 5</td>
                </tr>
                <tr class="style">
                    <td id="scard1">style carte 1</td>
                    <td id="scard2">style carte 2</td>
                    <td id="scard3">style carte 3</td>
                    <td id="scard4">style carte 4</td>
                    <td id="scard5">style carte 5</td>
                </tr>


                </tr>
            </table>
            <h4>Smartphone 2</h4>

            <table>
                <tr class="hit2">
                    <td id="hcard21">hit carte 1</td>
                    <td id="hcard22">hit carte 2</td>
                    <td id="hcard23">hit carte 3</td>
                    <td id="hcard24">hit carte 4</td>
                    <td id="hcard25">hit carte 5</td>
                </tr>
                <tr class="style2">
                    <td id="scard21">style carte 1</td>
                    <td id="scard22">style carte 2</td>
                    <td id="scard23">style carte 3</td>
                    <td id="scard24">style carte 4</td>
                    <td id="scard25">style carte 5</td>
                </tr>


                </tr>
            </table>
        </div>
        <div class="col-sm-6">
            <ul id="messages"></ul>
        </div>
    </div>
</div>


<script src="/socket.io/socket.io.js"></script>
<script>
    const table_socket = io();
    const phone1_socket = io();
    const phone2_socket = io();

    $('.hit').hide();
    $('.style').hide();
    $('.hit2').hide();
    $('.style2').hide();

    table_socket.on('chat message', function (msg) {
        $('#messages').append($('<li>').text('TABLE : ' + msg.message));
    });
    phone1_socket.on('chat message', function (msg) {
        $('#messages').append($('<li>').text('PHONE1 : ' + msg.message));
    });
    phone2_socket.on('chat message', function (msg) {
        $('#messages').append($('<li>').text('PHONE2 : ' + msg.message));
    });

    table_socket.on('update player', function (o) {
        let p1 = o['players'][0].id + ' (' + o['players'][0].health + ' hp) - position : ' + o['players'][0].position;
        let p2 = o['players'][1].id + ' (' + o['players'][1].health + ' hp) - position : ' + o['players'][1].position;

        $('#messages').append($('<li>').text(p1));
        $('#messages').append($('<li>').text(p2));
    });


    table_socket.on('card distribution', function (o) {
        $('.hit').show();
        $('.style').show();
        $('.hit2').show();
        $('.style2').show();

        let s1 = o.players[0].styleCards;
        let h1 = o.players[0].hitCards;
        let s2 = o.players[1].styleCards;
        let h2 = o.players[1].hitCards;

        for (let i = 1; i <= 5; i++) {
            let id = '#scard' + i;
            let id2 = '#hcard' + i;
            let id3 = '#scard2' + i;
            let id4 = '#hcard2' + i;
            $(id).text(s1[i - 1].title);
            $(id2).text(h1[i - 1].title);
            $(id3).text(s2[i - 1].title);
            $(id4).text(h2[i - 1].title);
        }
    });


    phone1_socket.on('card distribution', function (o) {
        $('.hit').show();
        $('.style').show();
        let s = o.player.styleCards;
        let h = o.player.hitCards;
        for (let i = 1; i <= 5; i++) {
            let id = '#scard' + i;
            let id2 = '#hcard' + i;
            $(id).text(s[i - 1].title);
            $(id2).text(h[i - 1].title);
        }
    });

    phone2_socket.on('card distribution', function (o) {
        $('.hit2').show();
        $('.style2').show();
        let s = o.player.styleCards;
        let h = o.player.hitCards;
        for (let i = 1; i <= 5; i++) {
            let id = '#scard2' + i;
            let id2 = '#hcard2' + i;
            $(id).text(s[i - 1].title);
            $(id2).text(h[i - 1].title);
        }
    });

    table_socket.on('start round', function (o) {
        let p1 = o['players'][0].id + ' is rank ' + o['players'][0].rank;
        let p2 = o['players'][1].id + ' is rank ' + o['players'][1].rank;
        $('#messages').append($('<li>').text(p1));
        $('#messages').append($('<li>').text(p2));
    });

    table_socket.on('ready to start', function (o) {
        console.log('table ready to start ')//, JSON.stringify(o))
    });


    phone1_socket.on('ready to start', function (o) {
        console.log('phone 1 ready to start')//, JSON.stringify(o))
    });

    phone2_socket.on('ready to start', function (o) {
        console.log('phone 2 ready to start ')//, JSON.stringify(o))
    });

    table_socket.on('death', function (o) {
        o.deads.forEach(a => {
            $('#messages').append($('<li>').text(a + ' est MORT 🤣🤣🤣'));
        })
    });

    table_socket.on('game over', function (a) {
        $('#messages').append($('<li>').text(a.players[0]+  ' a gagné 😱😱😱'));
        console.log('GAME OVER #############')
        console.log(a)
    });

    function sendAllPicks() {
        table_socket.emit('players picks', {
            game: 'gameroom#1',
            players: [
                {
                    id: 'player 1',
                    hitPick: {
                        "title": "Coudasse",
                        "type": "Coup",
                        "priority": "7",
                        "power": "3",
                        "range": "1",
                        "actions": [
                            {
                                "time": "during",
                                "action": "basic",
                                "value": 0
                            }
                        ],
                        "before": "",
                        "during": "",
                        "after": "",
                        "flavor": "LA COUDASSE\n"
                    },
                    stylePick: {
                        "title": "empoisoné",
                        "type": "Style",
                        "priority": "4",
                        "power": "0",
                        "range": "1",
                        "actions": [
                            {
                                "time": "during",
                                "action": "poison",
                                "value": "3"
                            }
                        ],
                        "before": "déplacement",
                        "during": "inflige 1 dégat à la fin de chaque tour pour 3 tours",
                        "after": "",
                        "flavor": "\n"
                    },
                },
                {
                    id: 'player 2',
                    hitPick: {
                        "title": "Coup de poing américain",
                        "type": "Coup",
                        "priority": "4",
                        "power": "4",
                        "range": "1",
                        "actions": [
                            {
                                "time": "during",
                                "action": "basic",
                                "value": 0
                            }
                        ],
                        "before": "",
                        "during": "",
                        "after": "",
                        "flavor": "l'équipe est gantée\n"
                    },
                    stylePick: {
                        "title": "revigorant",
                        "type": "Style",
                        "priority": "5",
                        "power": "0",
                        "range": "0",
                        "actions": [
                            {
                                "time": "after",
                                "action": "heal",
                                "value": "3"
                            }
                        ],
                        "before": "",
                        "during": "",
                        "after": "soin +3",
                        "flavor": "\n"
                    },
                }
            ]
        })
    }

    function sendPhone1Picks() {
        phone1_socket.emit('player picks', {
            game: 'gameroom#1',
            player:
                {
                    id: phone1_socket.id,
                    hitPick: {
                        "title": "Coudasse",
                        "type": "Coup",
                        "priority": "7",
                        "power": "3",
                        "range": "1",
                        "actions": [
                            {
                                "time": "during",
                                "action": "basic",
                                "value": 0
                            }
                        ],
                        "before": "",
                        "during": "",
                        "after": "",
                        "flavor": "LA COUDASSE\n"
                    },
                    stylePick: {
                        "title": "empoisoné",
                        "type": "Style",
                        "priority": "4",
                        "power": "0",
                        "range": "1",
                        "actions": [
                            {
                                "time": "during",
                                "action": "poison",
                                "value": "3"
                            }
                        ],
                        "before": "déplacement",
                        "during": "inflige 1 dégat à la fin de chaque tour pour 3 tours",
                        "after": "",
                        "flavor": "\n"
                    },
                }
        })
    }

    function sendPhone2Picks() {
        phone2_socket.emit('player picks', {
            game: 'gameroom#1',
            player: {
                id: phone2_socket.id,
                hitPick: {
                    "title": "Coup de poing américain",
                    "type": "Coup",
                    "priority": "4",
                    "power": "4",
                    "range": "1",
                    "actions": [
                        {
                            "time": "during",
                            "action": "basic",
                            "value": 0
                        }
                    ],
                    "before": "",
                    "during": "",
                    "after": "",
                    "flavor": "l'équipe est gantée\n"
                },
                stylePick: {
                    "title": "revigorant",
                    "type": "Style",
                    "priority": "5",
                    "power": "0",
                    "range": "0",
                    "actions": [
                        {
                            "time": "after",
                            "action": "heal",
                            "value": "3"
                        }
                    ],
                    "before": "",
                    "during": "",
                    "after": "soin +3",
                    "flavor": "\n"
                },
            }
        })
    }

    function distribute(o) {
        table_socket.emit('send cards', {game: o})
    }

    function sendAction1(y) {
        table_socket.emit('player attack', {
            game: 'gameroom#1',
            attack: {
                player: 'player 1',
                action: 'basic',
                power: 10,
                target: y
            }
        })
    }

    function sendAction2(y) {
        table_socket.emit('player attack', {
            game: 'gameroom#1',
            attack: {
                player: 'player 2',
                action: 'basic',
                power: 2,
                target: y
            }
        })
    }

    function sendEffect1(y) {
        table_socket.emit('player effect', {
            game: 'gameroom#1',
            player: 'player 1',
            action: 'movement',
            value: y
        })
    }


    function sendEffect2(y) {
        table_socket.emit('player effect', {
            game: 'gameroom#1',
            player: 'player 2',
            action: 'movement',
            value: y
        })
    }

    function connectTable(t) {
        table_socket.emit('start game', {players: 2, type: t})
    }

    function connectPhone1(o) {
        phone1_socket.emit('join game', {game: o})
    }

    function connectPhone2(o) {
        phone2_socket.emit('join game', {game: o})
    }

    function resetGames() {
        table_socket.emit('reset games', {})
    }


</script>

</body>
</html>